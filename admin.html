<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>RDM Jobs Admin</title>

<!-- Bootstrap & Icons -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet" />
<link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<style>
body{
  font-family:"Segoe UI",system-ui;
  background:#f1f5f9;
  padding-top:72px;
}
.admin-header{
  height:64px;
  background:linear-gradient(90deg,#2563eb,#1e3a8a);
}
.brand{
  color:#fff;
  font-weight:700;
  letter-spacing:1px;
  text-decoration:none;
}
#loginSection .card{
  width:340px;
  border-radius:16px;
  border:none;
}
.form-control{border-radius:10px;font-size:.9rem}
.input-group-text{background:#fff}
.btn{border-radius:10px}
#quillEditor{
  background:#fff;
  border-radius:12px;
}
.table td,.table th{vertical-align:middle}
</style>
</head>

<body>

<!-- HEADER -->
<header class="admin-header position-fixed top-0 start-0 end-0 z-3 shadow-sm">
  <div class="container-fluid h-100 d-flex align-items-center justify-content-between px-4">
    <a href="index.html" class="brand">RDMJOBS</a>
    <span class="text-white-50 small d-none d-md-block">Job Management</span>
  </div>
</header>

<!-- LOGIN -->
<section id="loginSection" class="d-flex justify-content-center align-items-center"
  style="min-height:calc(100vh - 72px);">
  <div class="card shadow p-4">
    <div class="text-center mb-3">
      <div class="bg-primary text-white rounded-circle d-inline-flex align-items-center justify-content-center"
        style="width:56px;height:56px;">
        <i class="bi bi-person-lock fs-4"></i>
      </div>
      <h5 class="fw-bold mt-3">Admin Login</h5>
      <p class="text-muted small">Authorized access only</p>
    </div>

    <form onsubmit="event.preventDefault(); login();">
      <div class="input-group mb-3">
        <span class="input-group-text"><i class="bi bi-envelope"></i></span>
        <input type="email" id="email" class="form-control"
          placeholder="hr@rdmjobs.com" required />
      </div>

      <div class="input-group mb-3">
        <span class="input-group-text"><i class="bi bi-lock"></i></span>
        <input type="password" id="password" class="form-control" placeholder="Password" required />
        <button type="button" class="btn btn-outline-secondary" onclick="togglePassword()">
          <i id="eyeIcon" class="bi bi-eye"></i>
        </button>
      </div>

      <button class="btn btn-primary w-100">
        <i class="bi bi-box-arrow-in-right"></i> Sign In
      </button>
    </form>
  </div>
</section>

<!-- ADMIN PANEL -->
<section id="adminPanel" class="container mt-5 d-none">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h6>Welcome, <span id="userEmail" class="text-primary"></span></h6>
    <button class="btn btn-outline-secondary btn-sm" onclick="logout()">
      <i class="bi bi-box-arrow-right"></i> Logout
    </button>
  </div>

  <button class="btn btn-success mb-3" data-bs-toggle="modal" data-bs-target="#createJobModal">
    <i class="bi bi-plus-circle"></i> Create Job
  </button>

  <div class="table-responsive">
    <table class="table table-striped table-hover text-center">
      <thead class="table-dark">
        <tr>
          <th>#</th>
          <th>Title</th>
          <th>Type</th>
          <th>Posted</th>
          <th>Last Date</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="jobsBody"></tbody>
    </table>
  </div>
</section>

<!-- CREATE JOB MODAL -->
<div class="modal fade" id="createJobModal">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <form id="jobForm">
        <div class="modal-header">
          <h5 class="modal-title">Post New Job</h5>
          <button class="btn-close" data-bs-dismiss="modal"></button>
        </div>

        <div class="modal-body">
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">Job Title</label>
              <input id="jobTitle" class="form-control" required />
            </div>

            <!-- ✅ JOB TYPE TEXT INPUT -->
            <div class="col-md-6">
              <label class="form-label">Job Type</label>
              <input id="jobType" class="form-control" placeholder="Eg: Government / Private / IT" required />
            </div>

            <div class="col-md-6">
              <label class="form-label">Last Date</label>
              <input type="date" id="jobLastDate" class="form-control" required />
            </div>
          </div>

          <div class="mt-3">
            <label class="form-label">Job Details</label>
            <div id="quillEditor" style="height:220px;"></div>
          </div>
        </div>

        <div class="modal-footer">
          <button class="btn btn-success">Save Job</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
<script src="https://cdn.quilljs.com/1.3.7/quill.js"></script>

<script>
const firebaseConfig={
  apiKey:"AIzaSyAzXgI8kvqz9CEo9393W48yEZjUx6l_YNM",
  authDomain:"rdmjobs-78da3.firebaseapp.com",
  projectId:"rdmjobs-78da3"
};
firebase.initializeApp(firebaseConfig);
const auth=firebase.auth();
const db=firebase.firestore();

const quill = new Quill("#quillEditor", {
  theme: "snow",
  modules: {
    toolbar: [
      ["bold", "italic", "underline"],
      [{ list: "ordered" }, { list: "bullet" }],
      [{ color: [] }, { background: [] }],   // ✅ Text & Background color
      ["link", "image"],
      ["clean"]
    ]
  }
});


function togglePassword(){
  password.type=password.type==="password"?"text":"password";
  eyeIcon.className=password.type==="password"?"bi bi-eye":"bi bi-eye-slash";
}

function toggleSections(l,e=""){
  loginSection.classList.toggle("d-none",l);
  adminPanel.classList.toggle("d-none",!l);
  if(l) userEmail.innerText=e;
}

function login(){
  auth.signInWithEmailAndPassword(email.value,password.value)
  .then(u=>{toggleSections(true,u.user.email);loadJobs();})
  .catch(e=>alert(e.message));
}

function logout(){auth.signOut().then(()=>toggleSections(false));}

function genId(t){return t.replace(/\s+/g,"_")+"_"+Math.random().toString(36).slice(2,6);}

jobForm.addEventListener("submit",async e=>{
  e.preventDefault();
  const id=genId(jobTitle.value);
  await db.collection("jobs").doc(id).set({
    id,
    title:jobTitle.value,
    type:jobType.value,
    lastDate:jobLastDate.value,
    content:quill.root.innerHTML,
    createdBy:auth.currentUser.email,
    postedAt:new Date().toISOString()
  });
  bootstrap.Modal.getInstance(createJobModal).hide();
  jobForm.reset(); quill.setText(""); loadJobs();
});

async function loadJobs(){
  jobsBody.innerHTML="";
  const s=await db.collection("jobs").orderBy("postedAt","desc").get();
  let i=1;
  s.forEach(d=>{
    const j=d.data();
    jobsBody.innerHTML+=`
      <tr>
        <td>${i++}</td>
        <td>${j.title}</td>
        <td>${j.type}</td>
        <td>${new Date(j.postedAt).toLocaleDateString()}</td>
        <td>${j.lastDate}</td>
        <td>
          <button class="btn btn-sm btn-danger" onclick="deleteJob('${j.id}')">
            <i class="bi bi-trash"></i>
          </button>
        </td>
      </tr>`;
  });
}

async function deleteJob(id){
  if(confirm("Delete this job?")){
    await db.collection("jobs").doc(id).delete();
    loadJobs();
  }
}

auth.onAuthStateChanged(u=>{
  u?(toggleSections(true,u.email),loadJobs()):toggleSections(false);
});
</script>

</body>
</html>
