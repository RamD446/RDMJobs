<!-- private.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Private Jobs - RDM Jobs</title>

  <!-- Bootstrap + Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet"/>
  <link href="styles.css" rel="stylesheet"/>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <style>
    .card {
      border-radius: 12px;
      overflow: hidden;
    }
    .pagination button {
      min-width: 36px;
    }
  </style>
</head>
<body>
  <div class="site-wrapper">
    <!-- Header -->
    <div id="header-container"></div>

    <!-- Main -->
    <div class="main-content p-3 mt-5">
      <h4 class="mb-4 text-success fw-bold d-flex align-items-center">
        <i class="bi bi-building me-2"></i> Private Jobs
      </h4>

      <div id="jobList"></div>
    </div>

    <!-- Footer -->
    <div class="footer-container"></div>
  </div>

  <!-- Firebase Job Loader -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getFirestore, collection, query, where, orderBy, getDocs } 
      from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

    // ðŸ”¹ Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyAzXgI8kvqz9CEo9393W48yEZjUx6l_YNM",
      authDomain: "rdmjobs-78da3.firebaseapp.com",
      projectId: "rdmjobs-78da3",
      storageBucket: "rdmjobs-78da3.appspot.com",
      messagingSenderId: "850369074130",
      appId: "1:850369074130:web:c96133288fb6cabdd82e0b"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // ðŸ”¹ Time Ago Formatter
    function getTimeAgo(postedAt) {
      const now = new Date();
      const postDate = postedAt?.toDate ? postedAt.toDate() : new Date(postedAt);
      const diffMs = now - postDate;
      const diffMin = Math.floor(diffMs / 60000);
      const diffHour = Math.floor(diffMin / 60);
      const diffDay = Math.floor(diffHour / 24);

      if (diffMin < 1) return { text: "Just now", color: "text-success" };
      if (diffMin < 60) return { text: `${diffMin} min ago`, color: "text-success" };
      if (diffHour < 24) return { text: `${diffHour} hour${diffHour !== 1 ? "s" : ""} ago`, color: "text-warning" };
      return { text: `${diffDay} day${diffDay !== 1 ? "s" : ""} ago`, color: "text-danger" };
    }

    // ðŸ”¹ Render Job Card
    function renderJobCard(job) {
      const tempDiv = document.createElement("div");
      tempDiv.innerHTML = job.content || "";
      const shortContent = tempDiv.textContent.trim().slice(0, 90) + "...";
      const time = getTimeAgo(job.postedAt);

      return `
        <div class="col-md-6 col-lg-4">
          <div class="card h-100 border border-success shadow-sm">
            <div class="bg-light px-3 py-2 border-bottom">
              <h6 class="fw-bold text-dark mb-0" style="font-size: 1rem;">
                ${job.title || 'Untitled Job'}
              </h6>
            </div>
            <div class="card-body bg-white" style="font-size: 0.95rem;">
              <p class="text-muted small mb-2">${shortContent}</p>
              <p class="mb-1 text-dark"><strong>Type:</strong> 
                <span class="fw-bold text-dark">
                  ${job.type || "Private"} ${job.tags ? `|| ${job.tags}` : ""}
                </span>
              </p>
            </div>
            <div class="bg-light px-3 py-2 d-flex justify-content-between align-items-center border-top">
              <span class="${time.color} small"><i class="bi bi-clock me-1"></i>${time.text}</span>
              <a href="job-details.html?jobId=${job.id}" class="btn btn-sm btn-outline-success">
                <i class="bi bi-eye-fill me-1"></i> Full Details
              </a>
            </div>
          </div>
        </div>
      `;
    }

    // ðŸ”¹ Pagination Globals
    let allJobs = [];
    let currentPage = 1;
    const jobsPerPage = 9;

    function renderPaginatedJobs() {
      const jobList = document.getElementById("jobList");
      jobList.innerHTML = "";

      if (!allJobs.length) {
        jobList.innerHTML = "<p class='text-center text-muted'>No Private jobs found.</p>";
        return;
      }

      const start = (currentPage - 1) * jobsPerPage;
      const end = start + jobsPerPage;
      const jobsToShow = allJobs.slice(start, end);

      const jobCardsHTML = jobsToShow.map(renderJobCard).join("");
      jobList.innerHTML = `
        <div class="row g-3">${jobCardsHTML}</div>
        <div class="d-flex justify-content-center mt-4">
          ${renderPaginationControls()}
        </div>
      `;
    }

    function renderPaginationControls() {
      const totalPages = Math.ceil(allJobs.length / jobsPerPage);
      let buttons = "";

      for (let i = 1; i <= totalPages; i++) {
        buttons += `
          <button class="btn btn-sm ${i === currentPage ? "btn-success" : "btn-outline-success"} mx-1"
                  onclick="changePage(${i})">${i}</button>
        `;
      }
      return buttons;
    }

    window.changePage = function(page) {
      currentPage = page;
      renderPaginatedJobs();
    };

    // ðŸ”¹ Load Private Jobs
    async function loadPrivateJobs() {
      const jobList = document.getElementById("jobList");
      jobList.innerHTML = `
        <div class="text-center text-muted py-5">
          <div class="spinner-border text-success mb-3" role="status"></div><br>
          Loading Private jobs...
        </div>
      `;

      try {
        const q = query(
          collection(db, "jobs"),
          where("type", "==", "Private"),
          orderBy("createdDate", "desc")
        );
        const snapshot = await getDocs(q);

        allJobs = [];
        snapshot.forEach((docSnap) => {
          allJobs.push({ id: docSnap.id, ...docSnap.data() });
        });

        renderPaginatedJobs();
      } catch (error) {
        console.error("Error loading Private jobs:", error);
        jobList.innerHTML = "<p class='text-center text-danger'>Error loading jobs. Please try again later.</p>";
      }
    }

    // ðŸ”¹ Auto Load
    loadPrivateJobs();
  </script>

  <script src="header.js"></script>
  <script src="footer.js"></script>
</body>
</html>
